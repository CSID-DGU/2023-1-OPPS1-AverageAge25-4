{% load static %}
<head>
<link rel="stylesheet" href="{% static 'css/MainPage.css' %}?after">
    <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<div class="container">

    <div class="up">

        <div class="up-left">
            <img  src="{% static 'images/logo.png' %}" />
        </div>

            <div class="up-middle">
                <form class="searchbar" action="/search/" method="get">
                    <input type="text" name="keyword" placeholder="검색어를 입력하세요" >
                    <button class="search" type="submit">검색</button>
                </form>
            </div>
            <div class="up-right">
               <button  id="openModalButton" class="order">공지사항 순서 변경</button>

                <div id="myModal_order" class="modal">
                    <div class="modal-content">
                    <span class="close_order">&times;</span>
                    <h2>공지사항 순서 변경</h2>
                    <details>
                    <summary>공지사항 목록</summary>
                        <p><div>
                            {% for category in allcategory %}
                                <li>{{ category.Cid }} : {{ category.Cname }}</li>
                            {% endfor %}
                            원하는 카테고리 6개를 순서대로 입력해주세요.
                        </div></p>
                    </details>

                     <form class="input-wrapper" method="post" action="/mainPage/reorder/">
                        {% csrf_token %}
                         <div class="input-wrapper-up">
                         <div class="order_input" >
                             <label>공지사항1 :</label>
                             <select name="input1" class="option">
                                 <option value="" disabled selected style="display: none;">공지사항 1</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                                </select>
                         </div>
                        <div class="order_input" >
                            <label>공지사항2 :</label>
                            <select name="input2" class="option">
                                <option value="" disabled selected style="display: none;">공지사항 2</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="order_input">
                            <label>공지사항3 :</label>
                            <select name="input3" class="option">
                                <option value="" disabled selected style="display: none;">공지사항 3</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="order_input" >
                            <label>공지사항4 :</label>
                            <select name="input4" class="option">
                                <option value="" disabled selected style="display: none;">공지사항 4</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="order_input">
                            <label>공지사항5 :</label>
                            <select name="input5" class="option">
                                <option value="" disabled selected style="display: none;">공지사항 5</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                            </select>
                         </div>
                         <div class="order_input">
                            <label>공지사항6 : </label>
                            <select name="input6" class="option">
                                <option value="" disabled selected style="display: none;">공지사항 6</option>
                                {% for category in allcategory %}
                                <option value="{{category.Cname}}">{{category.Cname}}</option>
                                {% endfor %}
                            </select>
                          </div>
                         </div>
                         <div id="input-wrapper-down">
                            <button class="editBtn1" type="submit" >수정</button>
                         </div>
                    </form>
                </div>
            </div>

               <form  method="POST" action="{% url 'Login' %}" >
                    <button  id="Logout" type="submit">로그아웃</button>
               </form>
           </div>
    </div>

    <div class="down">

        <div class="component-wrapper">

           {% for category in categories %}
            <div class="row{{ forloop.counter }}">
                <h5 style="margin-left:10px">{{ category.Cname }}</h5>
                <ul>
                {% for notice in category.notice_set.all %}
                    <li class="noticelink"><a href="{{ notice.link }}" title="{{notice.title}}" style="text-decoration:none; color: black;">{{ notice.title }}</a> - {{ notice.time }}</li>
                {% endfor %}
                </ul>
            </div>
            {% endfor %}

        </div>

        <div class="menubar">
            <h5 style="text-align: center; ">KEYWORDS</h5>
            <ul id="keyword-list" style="margin-top: 0px;">
                {% regroup keywords by key as grouped_keywords %}

                {% for grouped_keyword in grouped_keywords %}
                <li class="keylist" >
                    {{ grouped_keyword.grouper }} -
                    {% for keyword in grouped_keyword.list %}
                        {{ keyword.Cid.Cname }}
                        {% if not forloop.last %}, {% endif %}
                    {% endfor %}

                    <input class="hiddenBtn" type="hidden" name="grouped_keyword_grouper" value="{{ grouped_keyword.grouper }}" />
                    <input class="hiddenBtn" type="hidden" name="keyword_cid_cname" value="{{ keyword.Cid.Cname }}"  />

                    <form method="get" action="/mainPage/{{ grouped_keyword.grouper }}/">
                        {% csrf_token %}
                        <input type="hidden" name="keyword_del" value="{{ grouped_keyword.grouper }}">
                        <button type="submit" class="delete-key-btn" >-</button>
                    </form>

                    <button class="openModals">Edit</button>

                    <div id="myModals{{ forloop.counter }}" class="modal">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <h3 style="text-align:center">키워드 수정</h3>
                            <form action="/mainPage/'{{ grouped_keyword.grouper|urlencode }}'/" method="post">
                                {% csrf_token %}
                                <div class="edit">
                                    <input type="hidden" name="now_keyword" value="{{ grouped_keyword.grouper }}">

                                    <label style="width:68px;">키워드를</label>
                                    <input id='' name='edit_keyword' type="text" placeholder="변경할 키워드">

                                    <label class="edit-label">로,&nbsp;&nbsp;카테고리를</label>

                                    <div class="cat-container2">
                                        {% for category in allcategory %}
                                        <label class="cat-item">
                                            <input name="edit_category" type="checkbox" value="{{ category.Cid }}">
                                            <span style="font-size: 12px;">{{ category.Cname }}</span>
                                        </label>
                                        {% endfor %}
                                    </div>

                                    <label style="margin-left:5px">로</label>

                                     <div style="display:flex; justify-content: center;">
                                            <button class="editBtn2" type="submit">수정</button>
                                     </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>

            <div style=" display:flex;justify-content: center;">
                <button id="openModalButton2" >+</button>

                    <div id="myModal2" class="modal">
                        <div class="modal-content">
                            <span class="close2">&times;</span>
                            <h3>키워드 추가</h3>
                            <form class="keyinput-form" method="get" action="/mainPage/add/">
                                {% csrf_token %}
                                <label>키워드를 입력해주세요.</label>
                                <input class="keyinputBtn" name="keyword_add" type="text" placeholder="추가할 키워드를 입력해주세요.">
                                <div style="display: flex; align-items: center;">
                                    <label>카테고리를 골라주세요.</label>
                                    <div class="cat-container1" >
                                        {% for category in allcategory %}
                                        <label class= "cat-item">
                                            <input name="category_list" type="checkbox" style="width: 12px; height: 12px;" value="{{ category.Cid }}">
                                            <span style="font-size: 12px;">{{ category.Cname }}</span>
                                        </label>
                                        {% endfor %}
                                    </div>
                                </div>

                                <div style="display:flex; justify-content: center;">
                                    <button class="addBtn" type="submit" >추가</button>
                                </div>
                            </form>

                            <form id="key_sim" method="post" action="/mainPage/show_similar/">
                                {% csrf_token %}
                                <input id="key_sim_input" name="keyword_name" type="hidden">

                                <h6>test1</h6>
                                {% for key_sim in keywords_similar %}
                                <h6>{{ key_sim }}</h6>
                                {% endfor %}

                                <button type="submit">유사단어 추출</button>
                            </form>

                            <h6>test2</h6>
                            {% for key_sim in keywords_similar %}
                            <h6>{{ key_sim }}</h6>
                            {% endfor %}
                        </div>
                    </div>
            </div>
        </div>
    </div>
</div>
<script>
    // 공지사항 순서 변경 모달
    var modal3 = document.getElementById("myModal_order");
    var btn3 = document.getElementById("openModalButton");
    var closeBtn3 = document.getElementsByClassName("close_order")[0];

    function openModal3() {
    modal3.style.display = "block";
    }

    function closeModal3() {
    modal3.style.display = "none";
    }

    btn3.addEventListener("click", openModal3);
    closeBtn3.addEventListener("click", closeModal3);


    // 키워드 수정시 option에 따라서 기존 키워드 정보 출력
    function changePlaceholder() {
        var select = document.getElementById("target_select");
        var input = document.getElementById("edit_input");
        var checkboxes = document.querySelectorAll(".cat-container input[type='checkbox']");
        var selectedOption = select.options[select.selectedIndex].value;

        input.value = selectedOption;

        checkboxes.forEach(function (checkbox) {
        checkbox.checked = checkbox.value === selectedOption ? true : false;
    });
    }


    // 키워드 추가 관련 모달
    var modal2 = document.getElementById("myModal2");
    var btn2 = document.getElementById("openModalButton2");
    var closeBtn2 = document.getElementsByClassName("close2")[0];

    function openModal2() {
    modal2.style.display = "block";
    }
    function closeModal2() {
    modal2.style.display = "none";
    }

    btn2.addEventListener("click", openModal2);
    closeBtn2.addEventListener("click", closeModal2);


    // 중복 선택 방지를 위한 이벤트 핸들러
    function handleOptionSelection() {
        const selectedOptions = Array.from(document.querySelectorAll('.option')).map(select => select.value);
        const uniqueOptions = new Set(selectedOptions);

    // 중복된 옵션을 비활성화
    Array.from(document.querySelectorAll('.option option')).forEach(option => {
        if (uniqueOptions.has(option.value)) {
            option.disabled = true;
        } else {
            option.disabled = false;
        }
    });
    }

    // 모든 select 태그에 이벤트 핸들러 추가
    Array.from(document.querySelectorAll('.option')).forEach(select => {
        select.addEventListener('change', handleOptionSelection);
    });


    // 각 키워드당 수정 모달창
    var buttons = document.getElementsByClassName("openModals");

        function openModal(modalId) {
            var modal = document.getElementById(modalId);
            var closeBtn = modal.getElementsByClassName("close")[0];

            function openModalFn() {
                modal.style.display = "block";
            }

            function closeModalFn() {
                modal.style.display = "none";
            }

            buttons[i].addEventListener("click", openModalFn);
            closeBtn.addEventListener("click", closeModalFn);
        }

        for (var i = 0; i < buttons.length; i++) {
            var modalId = "myModals" + (i + 1);
            openModal(modalId);
        }

    function submitForm() {
        var keyword = document.getElementById("keyword_input").value; // keyword_add input의 값 가져오기

        // 다른 form 태그의 input에 값을 설정
        document.getElementById("key_sim_input").value = keyword;

        // 다른 form 태그의 submit 호출
        document.getElementById("key_sim").submit();
  }
</script>
